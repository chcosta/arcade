# build.yml
# Description: Defines the build phase
# Parameters:
#   agentOs: [Windows_NT (default), Linux, OSX] Used in templates to define variables which are OS specific
#   fetchDepth: Limit fetching to the specified number of commits from the tip of each remote branch history
#   phase: defined phase object
#      optionally includes preBuildSteps / postbuildSteps
parameters:
  agentOs: ''
  ciBuildArgs: ''
  clean: true
  fetchDepth: ''
  phase: {}

phases:
- phase: ${{ parameters.agentOs }}
  queue: ${{ parameters.phase.queue }}
  ${{ if and(ne(parameters.phase.variables, '') }}:
    variables: ${{ parameters.phase.variables }}
  steps:
  - checkout: self
    clean: ${{ parameters.clean }}
    ${{ if ne(parameters.fetchDepth, '') }}:
      fetchDepth: ${{ parameters.fetchDepth }}
  - ${{ if ne(parameters.phase.preBuildSteps, '') }}:
    - ${{ parameters.phase.preBuildSteps }}
  - ${{ if eq(parameters.agentOs, 'Windows_NT') }}:
    - script: eng\common\cibuild.cmd ${{ parameters.ciBuildArgs }}
      name: Build
      condition: succeeded()
  - ${{ if ne(parameters.agentOs, 'Windows_NT') }}:
    - script: eng/common/cibuild.sh ${{ parameters.ciBuildArgs }}
      name: Build
      condition: succeeded()
  - ${{ if ne(parameters.phase.postBuildSteps, '') }}:
    - ${{ parameters.phase.postBuildSteps }}
